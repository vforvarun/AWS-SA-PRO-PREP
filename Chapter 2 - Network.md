- Pre-requisites
    - Physical Layout of AZs and Regions
    - VPC Concept and how to create
    - Create private and public subnets
    - What a NAT is and what "Disable source/destination checks" mean
    - Route table and routing terminology (default routes, local routes)
    - IPv4 Addressing and Subnet Mask notation (/16, /24, etc)
    - Intermediate Networking Terminology (MAC Address, Port, Gateways vs Router)


- Concepts
    - OSI Model
      - 1. Physical -> Cat 5, Fiber Optic Cable, 5GZ -> Bits -> Please
      - 2. Data Link -> MAC Address -> Frame -> Do
      - 3. Network -> IP, ARP -> Packet -> Not
      - 4. Transport -> TCP -> Segment (TCP) / Datagram (UDP) -> Throw
      - 5. Session -> Setup, Negotiation and Teardown -> Sausage
      - 6. Presentation -> TLS/SSL, Compression -> Pizza
      - 7. Application -> Web Browser -> Away
    - AWS doesn't allow multicast
      - Unicast: More like phone call. 1x1 conversation, no impact to anyone else on the line.
      - Multicast: Shouting over a mega phone to everyone. Network card sending packets to everyone.
    - TCP vs UDP vs ICMP
      - TCP
        - Connection-based, stateful, acknowledges receipt
        - Analogy: After everything I say, I want you to confirm that you received it.
        - Uses: Web, Email, File Transfer
      - UDP
        - Connectionless, stateless, simple, no retransmission delays
        - Analogy: I'm going start talking and its OK if you miss some words.
        - Uses: Streaming media, DNS.
      - ICMP
        - Generally by network devices to exchange info
        - We routers can talk to each other about network health in our own language.
        - traceroute, ping
      - Ephemeral Ports
        - Short-lived transport protocol ports used in IP communications
        - Above the "well known" IP Port (above 1024)
        - Also called as Dynamic Ports
        - Suggested range is 49152 to 65535 but
          - Linux Kernels generally use 32568 to 61000
          - Windows platforms default from 1025
        - There are some NACL and Security Group implications

      - Simple Communication Scenario:
        - Web Server on 192.168.1.2 waits for connections on Port 80
        - Client on 192.168.1.6 initiates a connection to port 80 for a HTTP Session
        - Server responds "Hello, this is Server"
        - Client says "Hi, I'm client 6. You can use port 56784 to sent back what I request"
        - Server responds "Ok, will do. Here's your webpage and I'll keep your session open"
        - Client Requests another webpage
        - Server responds "Hey, I know you, I'll send you the data over the existing session"

      - AWS Availability Zones
        - The Physical to Logical assignment of AZs is done at the Account level

      - Network to VPC Connectivity
        - AWS Managed VPN
          - What: AWS managed IPsec VPN Connection over existing Internet Connection
          - When: Quick and usually simple way to establish a secure tunneled connection to a VPC; Redundant link for Direct Connect or other VPC VPN
          - Pros: Supports static routes or BGP Peering and routing
          - Cons: Dependent on your Internet Connection
          - How to create:
            - On AWS side
              - Create Virtual Private Gateway and attach to desired VPC
              - Create Customer Gateway on AWS
              - Create VPN Connection, linking Virtual Private Gateway with Customer Gateway
              - Download Customer Gateway config
            - On Customer side
              - Configure router to connect to AWS VPN Connection
              - Configure BGP routing (if needed)
        - AWS Direct Connect
          - What: Dedicated network connection over private lines into AWS backbone
          - When: Require a "big pipe" into AWS; lots of resources and services being provided on AWS to corporate users
          - Pros
            - More predictable network performance
            - Potential bandwidth cost reduction
            - Up to 10GBps provisioned connections
            - Supports BGP Peering and routing
          - Cons: May require additional telcom and hosting provider relationships and/or new network circuits.
          - How:
            - Work with your existing Data Provider
            - Create Virtual Interfaces (VIF) to connect to VPCs (Private VIF) or other AWS service like S3 or Glacier (Public VIF).

        - AWS Direct Connect + VPN
        - AWS VPN CloudHub
        - Software VPN
        - Transit VPC

      - Internet Gateways
        - Horizontally scaled, redundant and highly available component that allows communication between the VPC and the Internet.
        - No availability risk or bandwidth constraints
        - If the subnet is associated with a route to the Internet, then it is a public subnet
        - Support IPv4 and IPv6
        - Serves two purposes
          - Provide route table target for Internet-bound traffic
          - Perform NAT for instances with public IP addresses. It does not perform NAT for instances with Private IP's only.
      - Egress only Internet Gateways
        - For IPv6 Only,  IPv6 addresses are globally unique and are therefore public by default
        - Provides outbound Internet access for IPv6 addressed instances.
        - Prevents inbound Internet access to those IPv6 instances.
        - Stateful - forwards traffic from instance to internet and then sends back the response.
        - Must create a custom route for ::/0 to the Egress-Only Internet Gateway
        - Use Egress-Only Internet Gateway instead of NAT for IPv6
      - NAT Instance
        - EC2 instance from a special AWS-provided AMI
        - Translate traffic from many private IP instance to a single public IP and back
        - Doesn't allow public internet initiated connections into private instances
        - Not supported for IPv6 (use Egress-Only Gateway)
        - NAT Instance must live on a public subnet with a route to Internet Gateway
        - Private Instances in a private subnet must have route to the NAT instance, usually the default route destination of 0.0.0.0/0
      - NAT Gateway
        - Fully-managed NAT service that replaces the need for NAT Instance on EC2
        - Must be created in a Public Subnet
        - Uses an Elastic IP for public IP for the life of the gateway
        - Private instances in a private subnet must have route to the NAT instance, usually default route destination of 0.0.0.0/0
        - Created in specified AZ with redundancy in that zone.
        - For multi-AZ redundance, create NAT Gateways in each AZ with routes for private subnets to use the local Gateway.
        - Up to 5Gbps bandwidth that can scale up to 45 5Gbps
        - Can't use a NAT Gateway to access VPC peering, VPN or Direct Connect, so be sure to include specific routes to those in your route table (always most specific route is selected first)
      - NAT Instance vs Gateway
        - Availability
          - NAT Gateway: Highly available within AZ
          - NAT Instance: On your own
        - Bandwidth
          - NAT Gateway: Up to 45 Gbps
          - NAT Instance: Depends on bandwidth of instance type
        - Maintenance
          - NAT Gateway: Managed by AWS
          - NAT Instance: On your own
        - Performance
          - NAT Gateway: Optimized for NAT
          - NAT Instance: Amazon Linux AMI configured to perform NAT
        - Public IP
          - NAT Gateway: Elastic IP that cannot be detached
          - NAT Instance: Elastic IP that can be detached
        - Security Groups
          - NAT Gateway: Cannot be associated with NAT Gateway
          - NAT Instance: Can use Security Groups
        - Bastion Server
          - NAT Gateway: Not Supported
          - NAT Instance: Can be used as bastion server
      - Routing
        - VPC Context
          - Route Tables
            - VPCs have an implicit router and main route table
            - Main routing table can be modified or new tables can be created
            - Each route table contains a local route for the CIDR block
            - Most specific route for an address wins
          - Border Gateway Protocol
            - Popular routing protocol for the Internet
            - "Propagates" information about the network to allow for dynamic routing
            - Required for Direct Connect and optional for VPN
            - Alternative of not using BGP with AWS VPC is static routes
            - AWS supports BGP community tagging as a way to control traffic scope and route preference
            - Required TCP port 179 + ephemeral ports
            - Autonomous System Number (ASN) = Unique endpoint identifier
            - Weighting is local to the router and higher weight is preferred path for outbound traffic
        - Enhanced Networking
          - Generally used for High Performance Computing use-cases
          - Uses single root I/O virtualisation (SR-IOV) to deliver higher performance than traditional virtualised network interfaces
          - Might have to install driver if other than Amazon Linux HVM AMI
          - Intel 82599 VF Interface: 10 Gbps
          - Elastic Network Adapter: 25 Gbps
      - Route 53
        - Register domain names
        - Check the health of domain resources
        - Route internet traffic for the domain
        - Pre-requisites
          - What is DNS?
          - DNS record types (A, CNAME, MX, TXT, etc)
          - Route 53 concepts (alias, hosted zone etc)
          - Why is it called Route 53? Because the DNS port is 53
        - Route53 routing policies
          - Simple: Simple, here is the destination for that name. Name -> IP Address
          - Failover: Normally, I'd route to <Primary>, but it appears down based on health checks, so, will failover to <Backup>
          - Geolocation: Looks like the request is from Europe, so, route to a resource closer to Europe.
          - Geoproximity: close to US-EAST-1 than US-EAST-2, so routing to US-EAST-1
            - Bias (-99 to +99) can influence the result. Positive or Negative bias.
          - Latency: route the requests to a lower latency path to the resource
            - Is different from Geolocation. If a request is coming from US-EAST-1 tp Europe, if the latency to the servers in Europe is higher than that of US, then ther request will still be send to US-EAST-1
          - Multivalue Answer: return several IP address, kind of like a basic load balancer.
            -
          - Weighted: Setup multiple resources and routing is based on percentage of weight assigned to each resource
            - 0 weight - disable traffic
            - Weight values can have values ranging from 0 - 255
            - Percentage of traffic = Weight for a specified record/Sum of all weights for all records
            - For eg.
              - If E1=10 and E2=10, then E1%=50 and E2%=50
              - If E1=250 and E2=101, then E1%=71.2 and E2%=28.8
              - If E1=0 and E2=1, then E1%=0 and E2%=100
              - If E1=11 and E2=10, then E1%=52.3 and E2%=47.6
            - Used for Blue/Green deployments
        - CloudFront
          - Distributed content delivery service for simple static asset caching up to 4k live and on-demand video streaming
          - Pre-requisites
            - How to create CloudFront distribution
            - Understand Edge location concept
          - Integrated with Amazon Certificate Manager and supports SNI (Server Name Identification)
          - SSL, TLS and SNI
            - SSL and TLS:
              - 1995: SSL v2 was the first public release of SSL by Netscape
              - 1996: SSL v3 released to fix some security design flaws.
              - 1999: TLS v1.0 with SSL backwards
              - 2004: SSL v3 considered insecure due to POODLE attack vulnerability
              - 2005: TLS v1.1
              - 2008: TLS v1.2
              - Present: TLS 1.3 currently in working draft specification
            - Default CloudFront SSL certificate can be used, but if custom domain  is being used to serve the data then we need to use a custom certificate.
              - This certificate can be generated using the AWS Certificate Manger or it can be purchased from a 3rd Party vendor and uploaded to IAM.
              - A wild card certificate is good for any of the sub-domains. For eg., \*.example.com is good for www.example.com or cdn.example.com
              - There is one problem with this approach.
                - One of SSL's main functions is to guarantee that the website is legitimate.
                - It does it by making sure that the domain name of the server matches with the cert otherwise a warning is displayed in the browser.
                - CloudFront is a shared service, the host machines behind CloudFront will be serving up all sorts of content and SSL certificates. There are two ways to get around this issue.
                    - Pay for a dedicated IP address for each edge location. This dedicated IP address would serve up the required content using the certificate that has been applied.
                    - Server Name Identification (SNI) allows the client to specify which host it is trying to connect to and the server can present multiple certificates on the same IP address. So, the client is asking for the correct certificate and the server CloudFront in this case is presenting it. One downside of using SNI is that a few old browsers don't support it.
                - Security Policy
                    - Specify what SSL or TLS versions CloudFront supports.
          - Elastic Load Balancers
            - Distributes inbound connections to backend endpoints
            - Three different options
              - Application Load Balancer (Layer 7, Application Layer)
                - ALB works at a higher level, it works at the Application Layer
                - Protocols: HTTP, HTTPS
                - Path or Host-based routing: Yes
                  - Can route based on the Path in the URL
                  - If https://www.example.com/customer, then the incoming request can be directed to backend servers which are dedicated to serving customer based requests.
                  - If https://www.example.com/login, then the incoming request can be directed to backend servers which are dedicated to serving login requests.
                - SSL Offloading: Yes
                - Server Name Identification (SNI): Yes
                - Sticky Sessions: Yes
                  - Maintains the client sessions to maintain continuity.
                - Static IP/Elastic IP: No
                - User Authentication: Yes
              - Network Load Balancer (Layer 4, Transport Layer)
                - this should be used when speed matters.
                - Example: If an incoming file upload request is directed at Port 22 (scp), then the request can be distributed to worker servers, which process the incoming file and may be upload to Dyanmo DB.
                - Protocols: TCP
                - Path or Host-based routing: No
                - SSL Offloading: No
                - Server Name Identification (SNI): No
                - Sticky Sessions: No
                - Static IP/Elastic IP: Yes
                - User Authentication: No  
              - Classic Load Balancer (Layer 7 or Layer 4)
                - Protocols: TCP, SSL, HTTP, HTTPS
                - Path or Host-based routing: No
                - SSL Offloading: Yes
                - Server Name Identification (SNI): No
                - Sticky Sessions: Yes
                - Static IP/Elastic IP: No
                - User Authentication: No
            - Can be used for both Private and Public workloads
            - AWS recommends using NLB or ALB. CLB is being phased out.
        - Exam tips
          - VPC
            - Know the pros and cons of each On-prem to AWS connection modes (VPN, Direct Connect)
            - Know the functions of different VPC Components (Customer Gateway, Virtual Private Gateway)
            - Know that Direct Connect is not inherently redundant, so know how to architect a network that *is* (VPN or secondary Direct Connect)
            - Multicast and Broadcast is not supported. Reason: they are a layer 2 item.
            - Know what is meant by "stateless", "stateful", "connectionless", and "connection based" in terms of IP protocols
            - Know what ephemeral ports are and why they might need to be open in NACLs or SGs
          - Routing
            - Understand BGP and how to use weighting to shift network traffic
            - Know how routes in a route table are prioritized (most specific first)
            - What other routing protocols does AWS support (one, only BGP, otherwise static routes)
          - VPC Peering
            - CIDR ranges cannot overlap.
            - After VPC owner accepts a peering request, routes must be added to respective route tables
            - Transitive peering is not supprorted, but mesh or hub-and-spoke architectures are.. with proper NACLs and routes
            - A Transit VPC is supported
          - Internet Gateway
            - Difference between NAT instance and NAT gateway
            - Internet Gateway is horizontally scaled, redundant, with no bandwidth constraints
            - NATs do have bandwidth constraints but...
            - VPCs can have multiple NATs across AZs and subnets for scale - as long as routes are defined properly.
            - Use Egress-only Gateway for IPv6
          - Route 53
            - Understand different types of routing policies and use cases
            - Know weighted formula
            - Route 53 is a global service
          - CloudFront
            - Understand what must happen to setup a custom domain
            - Understand what SNI enables and the necessary alternative
          - Elastic Load Balancer
            - Know the three different types of Load Balancers and at which OSI Layer they work
            - Understand which major features each deliver (protocol, SNI, Sticky Sessions, SSL offloading)
            - Know what sticky sessions are and when they come into play
          - Read White Papers
            - AWS VPC Connectivity Options: https://d0.awsstatic.com/whitepapers/aws-amazon-vpc-connectivity-options.pdf
            - Integrating AWS with Multiprotocol Label Switching: https://d1.awsstatic.com/whitepapers/Networking/integrating-aws-with-multiprotocol-label-switching.pdf
            - Overview of AWS Network Security: https://d1.awsstatic.com/whitepapers/Security/Networking_Security_Whitepaper.pdf
          - Watch videos
            - Networking many VPCs: Transit and Shared Architecture: https://www.youtube.com/watch?v=KGKrVO9xlqI
            - Another day, Another billion flows: https://www.youtube.com/watch?v=8gc2DgBqo9U
            - Deep Dive into the new Network Load Balancer: https://www.youtube.com/watch?v=z0FBGIT1Ub4
        - Pro Tips
          - Direct Connect may be a more complex and costlier option to setup but it could save big on bandwidth costs.
          - Explicitly deny as much traffic as possible with NACLs and SG - Principle of Least Privilege
          - Think through the VPC layout (watch video Networking many VPCs: Transit and Shared Architecture)
          - Route 53 can be used even if AWS is not the main domain registrar.
          - ELBs provide a useful layer of abstraction (as does Route 53 too!)
